<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="/css/bootstrap.min.css">
<title>상품 등록</title>
<!-- WYSIWYG(What You See Is What You Get) -->
<script src="/ckeditor/ckeditor.js"></script>
<script src="/js/jquery-3.6.0.js"></script>
<script>
function CheckAddProduct() {
	let form = document.newProduct;
	
	// 1) 상품 아이디 체크
	// 첫 글자는 P
	// 숫자를 조합해서 5~12자
	// 예) P1234
	let regExpId = /^P[0-9]{4,11}/;
	if(regExpId.test(form.productId.value)) {
		alert("[상품코드]\nP와 숫자를 조합하여 5~12자까지 입력하세요\n첫 글자는 P로 시작하세요");
		form.productId.select();
		form.productId.focus();
		return false;
	}
	
	// 2) 상품명 체그
	// 4~12까지 입력 가능
	// ex) 삼성갤럭시S22
	if(form.pname.value.length < 4 || form.pname.value.length > 12) {
		alert("[상품명]\n최소 4자에서 최대 12까지 입력하세요")
		form.pname.select();
		form.pname.focus();
		return false;
	}
	
	// 3) 상품 가격 체크
	// 숫자만 입력 가능. 음수 X
	if(form.unitPrice.value.length == 0 || isNaN(form.unitPrice.value)) {
		alert("[가격]\n숫자만 입력하세요")
		form.unitPrice.select();
		form.unitPrice.focus();
		return false;
	}
	
	if(form.unitPrice.value < 0) {
		alert("[가격]\n음수는 입력할 수 없습니다.")
		form.unitPrice.select();
		form.unitPrice.focus();
		return false;
	}
	
	// 12345.12 소수점 둘째자리까지 허용.
	// 숫자 표현 방식 : [0-9], \d
	// let regExpUnitPrice = /^\d+((\.)?([0-9]{1,2})?)?$/;
	let regExpUnitPrice = /^\d+(?:[.]?[\d]?[\d])?$/;
	if(!regExpUnitPrice.test(form.unitPrice.value)) {
		alert("[금액] 소수점 둘째자리까지만 허용됩니다");
		form.unitPrice.select();
		form.unitPrice.focus();
		return false;
	}
	
	
	// 4) 재고 수 체크
	// 숫자만 입력 가능
	if(isNaN(form.unitsInStock.value)) {
		alert("[재고수]\n숫자만 입력해주세요");
		form.unitsInStock.select();
		form.unitsInStock.focus();
		return false;
	}
	
	// 유효성 검사를 모두 통과했다면
	//alert("모두 통과!");
	swal('상품 등록 완료',"상품이 성공적으로 등록되었습니다",'success');
	
	
}



// document내 요소 모두 로딩 후 처리
$(function(){
	console.log("개똥이");
	
	// 이미지 미리보기 시작
	$("#productImage").on("change", handleImg);
	
	// e : change event
	function handleImg(e){
		// 첨부 파일들
		let files = e.target.files;
		// 파일 배열 Object
		let fileArr = Array.prototype.slice.call(files);
		// 파일 반복 -> 파일(f)
		fileArr.forEach(function(f){
			if(!f.type.match("image.*")) {
				alert("이미지 확장자만 가능합니다.");
				// 함수 종료
				return;
			}
			let reader = new FileReader();
			
			// e : 파일을 읽을 때 이벤트
			reader.onload = function(e){
				let img_html = "<img src='" + e.target.result + "' style='width:100%' />";
				// class = "col-sm-5 divImg"
				$(".divImg").html(img_html);
			}
			
			// 리더로 파일 읽음
			reader.readAsDataURL(f);
		});
		
	}
});
</script>
</head>
<body>
	<!-- header.jsp -->
	<jsp:include page="menu.jsp" />
	
	<!-- 상품 등록 시작 -->
	<div class="jumbotron">
		<!-- container : 이 안에 내용있다 -->
		<div class="container">
			<h1 class="display-3">상품 등록</h1>
		</div>
	</div>
	
	<!-- 상품 등록 폼 필드 시작 -->
	<div class="container">
		<!-- 폼 필드
		요청URL : processAddProduct.jsp
		요청방식 : post
		요청파라미터(HTTP파라미터, QueryString) :
			{productId=P1237, pname=에어팟3, unitPrice=200000,
			description=굿음질, manufacturer=Apple, category=Tablet,
			unitsInStock=1000, condition=Old}
		-->
		<form name="newProduct" action="processAddProduct.jsp"
			class="form-horizontal" method="post" enctype="multipart/form-data">
			<div class="form-group row">
				<label class="col-sm-2">상품 코드</label>
				<div class="col-sm-3">
					<input type="text" name="productId" class="form-control" required>
				</div>
			</div>
			<div class="form-group row">
				<label class="col-sm-2">상품명</label>
				<div class="col-sm-3">
					<input type="text" name="pname" class="form-control" required>
				</div>
			</div>
			<div class="form-group row">
				<label class="col-sm-2">가격</label>
				<div class="col-sm-3">
					<input type="number" name="unitPrice" class="form-control" required>
				</div>
			</div>
			<div class="form-group row">
				<label class="col-sm-2">상세 정보</label>
				<div class="col-sm-3">
					<textarea name="description" rows="3" cols="50" class="form-control"></textarea>
				</div>
			</div>
			<div class="form-group row">
				<label class="col-sm-2">제조사</label>
				<div class="col-sm-3">
					<input type="text" name="manufacturer" class="form-control">
				</div>
			</div>
			<div class="form-group row">
				<label class="col-sm-2">분류</label>
				<div class="col-sm-3">
					<input type="text" name="category" class="form-control">
				</div>
			</div>
			<div class="form-group row">
				<label class="col-sm-2">재고 수</label>
				<div class="col-sm-3">
					<input type="number" name="unitsInStock" class="form-control">
				</div>
			</div>
			<div class="form-group row">
				<label class="col-sm-2">상태</label>
				<div class="col-sm-5">
					<input type="radio" id="condition1" name="condition" value="New" />
						<label for="condition1">신규 제품</label>
					<input type="radio" id="condition2" name="condition" value="Old" />
						<label for="condition2">중고 제품</label>
					<input type="radio" id="condition3" name="condition" value="Refurbished" />
						<label for="condition3">재생 제품</label>
				</div>
			</div>
			<!-- 상품 이미지 -->
			<div class="form-group row">
				<label class="col-sm-2">상품 이미지</label>
				<div class="col-sm-5">
					<input type="file" id="productImage"
						name="productImage" class="form-control" />
				</div>
			</div>
			<!-- 상품 이미지 미리보기 -->
			<div class="form-group row">
				<label class="col-sm-2">이미지 미리보기</label>
				<div class="col-sm-5 divImg"></div>
			</div>
			<div class="form-group row">
				<div class="col-sm-offset-2 col-sm-10">
					<input type="submit" class="btn btn-primary" value="등록"
						onclick="CheckAddProduct()">
				</div>
			</div>
		</form>
	</div>
	<!-- 상품 등록 폼 필드 끝 -->
	
	<!-- footer.jsp -->
	<jsp:include page="footer.jsp" />
<script>
CKEDITOR.replace("description");
</script>
</body>
</html>